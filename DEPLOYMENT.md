# Deployment Guide - Concert Companion

## Architecture
- **Frontend**: Vercel (React app with HTTPS)
- **Backend**: Railway (Express API with HTTPS)
- **Database**: Railway (PostgreSQL)

---

## Part 1: Deploy Backend to Railway

### Step 1: Create Railway Account
1. Go to https://railway.app
2. Sign up with GitHub
3. Link your Concert-Companion repository

### Step 2: Create New Project
1. Click "New Project"
2. Select "Deploy from GitHub repo"
3. Choose `Concert-Companion` repository
4. Railway will auto-detect Node.js

### Step 3: Add PostgreSQL Database
1. In your Railway project, click "New"
2. Select "Database" → "PostgreSQL"
3. Railway will create a database and provide connection URL

### Step 4: Set Environment Variables for Backend
In Railway dashboard, go to your backend service → Variables:

```
NODE_ENV=production
PORT=5001
CLIENT_URL=https://your-app.vercel.app

# Database (Railway auto-provides DATABASE_URL, but set these if needed)
DATABASE_URL=${{Postgres.DATABASE_URL}}

# Spotify OAuth
SPOTIFY_CLIENT_ID=your_spotify_client_id
SPOTIFY_CLIENT_SECRET=your_spotify_client_secret
SPOTIFY_REDIRECT_URI=https://your-app.vercel.app/callback

# JWT
JWT_SECRET=your_secure_random_string_here

# Optional: External APIs
TICKETMASTER_API_KEY=your_ticketmaster_key
GOOGLE_PLACES_API_KEY=your_google_places_key
```

### Step 5: Deploy
1. Railway will auto-deploy on push to main
2. Get your backend URL: Railway will auto-generate something like:
   - `https://concert-companion-production.up.railway.app`
   - The exact URL is generated by Railway based on your project name
3. Copy this URL for Vercel setup

---

## Part 2: Deploy Frontend to Vercel

### Step 1: Create Vercel Account
1. Go to https://vercel.com
2. Sign up with GitHub

### Step 2: Import Project
1. Click "Add New Project"
2. Import `Concert-Companion` repository
3. **Important**: Set Root Directory to `client`

### Step 3: Configure Build Settings
Vercel should auto-detect React, but verify:
- **Framework Preset**: Create React App
- **Root Directory**: `client`
- **Build Command**: `npm run build`
- **Output Directory**: `build`

### Step 4: Set Environment Variables
In Vercel dashboard → Settings → Environment Variables:

```
REACT_APP_API_URL=https://concert-companion-production.up.railway.app
REACT_APP_SPOTIFY_CLIENT_ID=d88d1ff594d146b6a607b0b02f6cf2a3
```

**Note:** Replace the Railway URL with your actual generated URL from Railway dashboard.

### Step 5: Deploy
1. Click "Deploy"
2. Vercel will build and deploy your React app
3. Get your frontend URL: Vercel will auto-generate something like:
   - `https://concert-companion.vercel.app` or
   - `https://concert-companion-landonnguyen77.vercel.app`
   - The exact URL is generated by Vercel based on your repo name

---

## Part 3: Update Spotify App Settings

### Update Redirect URIs in Spotify Dashboard
1. Go to https://developer.spotify.com/dashboard
2. Select your app (Concert-Companion)
3. Click "Edit Settings"
4. Add to "Redirect URIs" (keep existing localhost entries):
   ```
   http://127.0.0.1:3000/callback
   http://localhost:3000/callback
   https://concert-companion.vercel.app/callback
   ```
   **Note:** Replace with your actual Vercel URL after deployment
5. Save changes

---

## Part 4: Final Configuration Updates

### Update Railway Backend Environment
Go back to Railway and update `CLIENT_URL` with your actual Vercel URL:
```
CLIENT_URL=https://concert-companion.vercel.app
SPOTIFY_REDIRECT_URI=https://concert-companion.vercel.app/callback
```

### Update Vercel Frontend Environment
Ensure `REACT_APP_API_URL` points to your actual Railway URL:
```
REACT_APP_API_URL=https://concert-companion-production.up.railway.app
```

**Important:** Both URLs are auto-generated by the platforms. Copy the exact URLs from their dashboards.

---

## Verification Checklist

- [ ] Railway backend is deployed and accessible
- [ ] Railway PostgreSQL is connected to backend
- [ ] Vercel frontend is deployed and accessible
- [ ] Frontend can make API calls to backend (check browser console)
- [ ] Spotify OAuth redirect works (test login)
- [ ] CORS allows Vercel domain to call Railway API
- [ ] All environment variables are set correctly
- [ ] Database tables are created (run schema.sql if needed)

---

## Common Issues & Fixes

### Issue: CORS Error
**Fix**: Make sure `CLIENT_URL` in Railway matches your Vercel URL exactly (including https://)

### Issue: Spotify Redirect Error
**Fix**: Verify `SPOTIFY_REDIRECT_URI` in Railway matches the redirect URI in Spotify Dashboard

### Issue: Database Connection Error
**Fix**: In Railway, link your PostgreSQL service to backend service, use `DATABASE_URL` variable

### Issue: Build Fails on Vercel
**Fix**: Ensure Root Directory is set to `client` and all dependencies are in `client/package.json`

---

## Deployment Commands (For Updates)

### Deploy Backend Updates
```bash
git add .
git commit -m "Update backend"
git push origin main
```
Railway auto-deploys from main branch.

### Deploy Frontend Updates
```bash
git add .
git commit -m "Update frontend"
git push origin main
```
Vercel auto-deploys from main branch.

---

## Free Tier Limits

### Railway Free Tier
- $5 credit per month
- Covers basic usage for hobby projects
- Sleeps after inactivity (configurable)

### Vercel Free Tier
- Unlimited personal projects
- 100 GB bandwidth/month
- Automatic HTTPS
- No sleep/cold starts

---

## Custom Domain (Optional)

### Add Custom Domain to Vercel
1. Go to Project Settings → Domains
2. Add your domain (e.g., concertcompanion.com)
3. Update DNS records as instructed
4. Update Railway `CLIENT_URL` to your custom domain

### Add Custom Domain to Railway
1. Go to Service Settings → Domains
2. Add custom domain for API (e.g., api.concertcompanion.com)
3. Update DNS records
4. Update Vercel `REACT_APP_API_URL` to your custom domain

---

## Support Resources

- Railway Docs: https://docs.railway.app
- Vercel Docs: https://vercel.com/docs
- Spotify OAuth: https://developer.spotify.com/documentation/web-api/tutorials/code-flow

---

**Need Help?** Check Railway logs and Vercel deployment logs for error messages.
